<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firewall Manager Pro - Painel de Homologação</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Source+Code+Pro:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a237e;
            --primary-light: #534bae;
            --primary-dark: #000051;
            --secondary: #00695c;
            --danger: #c62828;
            --warning: #f9a825;
            --success: #2e7d32;
            --light: #f5f5f5;
            --dark: #212121;
            --gray: #757575;
            --gray-light: #e0e0e0;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            transition: var(--transition);
            box-shadow: var(--shadow);
            z-index: 100;
        }
        
        .logo {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo span {
            color: #bbdefb;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 5px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .nav-link:hover, .nav-link.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-left: 4px solid #bbdefb;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .header h2 {
            font-size: 1.8rem;
            color: var(--primary);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .icon-danger {
            background-color: rgba(198, 40, 40, 0.1);
            color: var(--danger);
        }
        
        .icon-warning {
            background-color: rgba(249, 168, 37, 0.1);
            color: var(--warning);
        }
        
        .icon-success {
            background-color: rgba(46, 125, 50, 0.1);
            color: var(--success);
        }
        
        .icon-primary {
            background-color: rgba(26, 35, 126, 0.1);
            color: var(--primary);
        }
        
        .card-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .card-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Filter Bar */
        .filter-bar {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px 20px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 180px;
        }
        
        .filter-label {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        select, input {
            padding: 10px;
            border: 1px solid var(--gray-light);
            border-radius: 4px;
            font-family: 'Roboto', sans-serif;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            font-family: 'Roboto', sans-serif;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        /* Rules Table */
        .rules-container {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }
        
        .table-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .table-header h3 {
            color: var(--primary);
        }
        
        .rules-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .rules-table th {
            background-color: #f5f5f5;
            padding: 15px;
            text-align: left;
            font-weight: 500;
            color: var(--dark);
            border-bottom: 1px solid var(--gray-light);
        }
        
        .rules-table td {
            padding: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .rules-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-pending {
            background-color: rgba(249, 168, 37, 0.1);
            color: var(--warning);
        }
        
        .status-approved {
            background-color: rgba(46, 125, 50, 0.1);
            color: var(--success);
        }
        
        .status-rejected {
            background-color: rgba(198, 40, 40, 0.1);
            color: var(--danger);
        }
        
        .status-production {
            background-color: rgba(26, 35, 126, 0.1);
            color: var(--primary);
        }
        
        .env-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
            background-color: #e8f5e9;
            color: var(--success);
        }
        
        .priority-high {
            color: var(--danger);
            font-weight: bold;
        }
        
        .priority-medium {
            color: var(--warning);
            font-weight: bold;
        }
        
        .priority-low {
            color: var(--success);
            font-weight: bold;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            color: white;
            transition: var(--transition);
        }
        
        .action-btn:hover {
            opacity: 0.9;
        }
        
        .btn-approve {
            background-color: var(--success);
        }
        
        .btn-reject {
            background-color: var(--danger);
        }
        
        .btn-details {
            background-color: var(--primary);
        }
        
        /* Rule Details Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            color: var(--primary);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .rule-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .detail-item {
            margin-bottom: 15px;
        }
        
        .detail-label {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-weight: 500;
            font-family: 'Source Code Pro', monospace;
            background-color: #f5f5f5;
            padding: 8px 12px;
            border-radius: 4px;
            border-left: 3px solid var(--primary);
        }
        
        .rule-json {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: var(--border-radius);
            font-family: 'Source Code Pro', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            overflow-x: auto;
            margin-top: 20px;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-light);
            margin-top: 30px;
        }
        
        /* Responsive */
        @media (max-width: 1100px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 10px 0;
            }
            
            .nav-menu {
                display: flex;
                overflow-x: auto;
            }
            
            .nav-item {
                margin-bottom: 0;
                flex-shrink: 0;
            }
            
            .nav-link {
                border-left: none;
                border-bottom: 4px solid transparent;
            }
            
            .nav-link:hover, .nav-link.active {
                border-left: none;
                border-bottom: 4px solid #bbdefb;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .filter-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .rules-table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-shield-alt"></i> Firewall <span>Manager Pro</span></h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-list-check"></i>
                        <span>Homologação</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-database"></i>
                        <span>Bancos de Dados</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-server"></i>
                        <span>Ambientes</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-history"></i>
                        <span>Histórico</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">
                        <i class="fas fa-cog"></i>
                        <span>Configurações</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="header">
                <h2>Painel de Homologação de Regras de Firewall</h2>
                <div class="user-info">
                    <div class="avatar">AD</div>
                    <div>
                        <div class="user-name">Admin</div>
                        <div class="user-role">Segurança da Informação</div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Cards -->
            <div class="dashboard-cards">
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-value" id="pending-count">12</div>
                            <div class="card-label">Regras Pendentes</div>
                        </div>
                        <div class="card-icon icon-warning">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-value" id="approved-count">48</div>
                            <div class="card-label">Regras Aprovadas</div>
                        </div>
                        <div class="card-icon icon-success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-value" id="rejected-count">5</div>
                            <div class="card-label">Regras Rejeitadas</div>
                        </div>
                        <div class="card-icon icon-danger">
                            <i class="fas fa-times-circle"></i>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-value" id="environments-count">8</div>
                            <div class="card-label">Ambientes</div>
                        </div>
                        <div class="card-icon icon-primary">
                            <i class="fas fa-server"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="filter-group">
                    <div class="filter-label">Ambiente</div>
                    <select id="filter-environment">
                        <option value="all">Todos os Ambientes</option>
                        <option value="production">Produção</option>
                        <option value="homologation">Homologação</option>
                        <option value="development">Desenvolvimento</option>
                        <option value="testing">Testes</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <div class="filter-label">Status</div>
                    <select id="filter-status">
                        <option value="all">Todos os Status</option>
                        <option value="pending">Pendente</option>
                        <option value="approved">Aprovado</option>
                        <option value="rejected">Rejeitado</option>
                        <option value="production">Em Produção</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <div class="filter-label">Banco de Dados</div>
                    <select id="filter-database">
                        <option value="all">Todos os Bancos</option>
                        <option value="oracle">Oracle</option>
                        <option value="mysql">MySQL</option>
                        <option value="postgresql">PostgreSQL</option>
                        <option value="sqlserver">SQL Server</option>
                        <option value="mongodb">MongoDB</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <div class="filter-label">Prioridade</div>
                    <select id="filter-priority">
                        <option value="all">Todas as Prioridades</option>
                        <option value="high">Alta</option>
                        <option value="medium">Média</option>
                        <option value="low">Baixa</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" id="apply-filters">
                    <i class="fas fa-filter"></i> Aplicar Filtros
                </button>
                
                <button class="btn btn-success" id="new-rule">
                    <i class="fas fa-plus"></i> Nova Regra
                </button>
            </div>

            <!-- Rules Table -->
            <div class="rules-container">
                <div class="table-header">
                    <h3>Regras de Firewall</h3>
                    <div class="table-info">
                        Mostrando <span id="showing-count">10</span> de <span id="total-count">65</span> regras
                    </div>
                </div>
                
                <table class="rules-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome da Regra</th>
                            <th>Ambiente</th>
                            <th>Banco de Dados</th>
                            <th>Porta</th>
                            <th>Status</th>
                            <th>Prioridade</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="rules-table-body">
                        <!-- As regras serão carregadas via JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Footer -->
            <div class="footer">
                <p>Firewall Manager Pro &copy; 2023 - Sistema de Homologação de Regras de Firewall</p>
                <p>Última atualização: <span id="last-update">Carregando...</span></p>
            </div>
        </main>
    </div>

    <!-- Rule Details Modal -->
    <div class="modal" id="rule-details-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Detalhes da Regra de Firewall</h3>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="modal-body-content">
                <!-- Conteúdo será carregado via JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Dados simulados de regras de firewall
        const firewallRules = [
            {
                id: "FW-2023-001",
                name: "Acesso PostgreSQL Produção",
                environment: "production",
                database: "postgresql",
                port: "5432",
                sourceIP: "10.0.1.0/24",
                destinationIP: "192.168.1.10",
                protocol: "TCP",
                status: "production",
                priority: "high",
                requester: "João Silva",
                requestDate: "2023-10-15",
                approvalDate: "2023-10-18",
                approvedBy: "Maria Santos",
                description: "Permitir acesso da rede interna ao servidor de banco de dados PostgreSQL"
            },
            {
                id: "FW-2023-045",
                name: "Acesso MySQL Homologação",
                environment: "homologation",
                database: "mysql",
                port: "3306",
                sourceIP: "172.16.1.0/24",
                destinationIP: "192.168.2.20",
                protocol: "TCP",
                status: "pending",
                priority: "medium",
                requester: "Carlos Oliveira",
                requestDate: "2023-11-05",
                approvalDate: "",
                approvedBy: "",
                description: "Acesso para equipe de desenvolvimento ao MySQL de homologação"
            },
            {
                id: "FW-2023-032",
                name: "Backup SQL Server",
                environment: "production",
                database: "sqlserver",
                port: "1433",
                sourceIP: "10.0.2.5",
                destinationIP: "192.168.1.15",
                protocol: "TCP",
                status: "approved",
                priority: "high",
                requester: "Ana Pereira",
                requestDate: "2023-10-28",
                approvalDate: "2023-10-30",
                approvedBy: "Pedro Costa",
                description: "Acesso do servidor de backup ao SQL Server"
            },
            {
                id: "FW-2023-056",
                name: "Acesso MongoDB Desenvolvimento",
                environment: "development",
                database: "mongodb",
                port: "27017",
                sourceIP: "192.168.3.0/24",
                destinationIP: "192.168.2.30",
                protocol: "TCP",
                status: "rejected",
                priority: "low",
                requester: "Fernanda Lima",
                requestDate: "2023-11-01",
                approvalDate: "2023-11-02",
                approvedBy: "Ricardo Alves",
                description: "Acesso amplo à base de desenvolvimento - REJEITADO por política de segurança",
                rejectionReason: "Acesso muito amplo para ambiente de desenvolvimento"
            },
            {
                id: "FW-2023-067",
                name: "Monitoramento Oracle",
                environment: "production",
                database: "oracle",
                port: "1521",
                sourceIP: "10.0.3.10",
                destinationIP: "192.168.1.25",
                protocol: "TCP",
                status: "pending",
                priority: "high",
                requester: "Sistema de Monitoramento",
                requestDate: "2023-11-08",
                approvalDate: "",
                approvedBy: "",
                description: "Acesso do sistema Zabbix para monitoramento do Oracle"
            },
            {
                id: "FW-2023-021",
                name: "Acesso API Externa",
                environment: "testing",
                database: "mysql",
                port: "3306",
                sourceIP: "203.0.113.0/24",
                destinationIP: "192.168.2.25",
                protocol: "TCP",
                status: "approved",
                priority: "medium",
                requester: "Equipe de Integração",
                requestDate: "2023-10-20",
                approvalDate: "2023-10-22",
                approvedBy: "Maria Santos",
                description: "Acesso de serviço externo para testes de integração"
            },
            {
                id: "FW-2023-078",
                name: "Acesso PostgreSQL Backup",
                environment: "production",
                database: "postgresql",
                port: "5432",
                sourceIP: "10.0.2.10",
                destinationIP: "192.168.1.12",
                protocol: "TCP",
                status: "pending",
                priority: "medium",
                requester: "Equipe de Backup",
                requestDate: "2023-11-10",
                approvalDate: "",
                approvedBy: "",
                description: "Acesso para novo servidor de backup"
            },
            {
                id: "FW-2023-012",
                name: "Acesso Desenvolvedores Oracle",
                environment: "homologation",
                database: "oracle",
                port: "1521",
                sourceIP: "172.16.2.0/24",
                destinationIP: "192.168.2.15",
                protocol: "TCP",
                status: "production",
                priority: "low",
                requester: "Equipe de Desenvolvimento",
                requestDate: "2023-10-10",
                approvalDate: "2023-10-12",
                approvedBy: "Pedro Costa",
                description: "Acesso dos desenvolvedores ao ambiente de homologação Oracle"
            }
        ];

        // Função para renderizar as regras na tabela
        function renderRulesTable(rules) {
            const tableBody = document.getElementById('rules-table-body');
            tableBody.innerHTML = '';
            
            rules.forEach(rule => {
                const row = document.createElement('tr');
                
                // Mapeamento de status para classes CSS
                const statusClass = {
                    'pending': 'status-pending',
                    'approved': 'status-approved',
                    'rejected': 'status-rejected',
                    'production': 'status-production'
                };
                
                // Mapeamento de prioridade para classes CSS
                const priorityClass = {
                    'high': 'priority-high',
                    'medium': 'priority-medium',
                    'low': 'priority-low'
                };
                
                // Mapeamento de ambiente para texto
                const environmentText = {
                    'production': 'Produção',
                    'homologation': 'Homologação',
                    'development': 'Desenvolvimento',
                    'testing': 'Testes'
                };
                
                // Mapeamento de status para texto
                const statusText = {
                    'pending': 'Pendente',
                    'approved': 'Aprovado',
                    'rejected': 'Rejeitado',
                    'production': 'Em Produção'
                };
                
                row.innerHTML = `
                    <td>${rule.id}</td>
                    <td>${rule.name}</td>
                    <td><span class="env-badge">${environmentText[rule.environment]}</span></td>
                    <td>${rule.database.toUpperCase()}</td>
                    <td>${rule.port}</td>
                    <td><span class="status-badge ${statusClass[rule.status]}">${statusText[rule.status]}</span></td>
                    <td class="${priorityClass[rule.priority]}">${rule.priority === 'high' ? 'Alta' : rule.priority === 'medium' ? 'Média' : 'Baixa'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn btn-details" onclick="showRuleDetails('${rule.id}')" title="Ver detalhes">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${rule.status === 'pending' ? `
                                <button class="action-btn btn-approve" onclick="approveRule('${rule.id}')" title="Aprovar regra">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="action-btn btn-reject" onclick="rejectRule('${rule.id}')" title="Rejeitar regra">
                                    <i class="fas fa-times"></i>
                                </button>
                            ` : ''}
                        </div>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Atualizar contadores
            document.getElementById('showing-count').textContent = rules.length;
            document.getElementById('total-count').textContent = firewallRules.length;
        }
        
        // Função para filtrar regras
        function filterRules() {
            const environmentFilter = document.getElementById('filter-environment').value;
            const statusFilter = document.getElementById('filter-status').value;
            const databaseFilter = document.getElementById('filter-database').value;
            const priorityFilter = document.getElementById('filter-priority').value;
            
            let filteredRules = firewallRules;
            
            if (environmentFilter !== 'all') {
                filteredRules = filteredRules.filter(rule => rule.environment === environmentFilter);
            }
            
            if (statusFilter !== 'all') {
                filteredRules = filteredRules.filter(rule => rule.status === statusFilter);
            }
            
            if (databaseFilter !== 'all') {
                filteredRules = filteredRules.filter(rule => rule.database === databaseFilter);
            }
            
            if (priorityFilter !== 'all') {
                filteredRules = filteredRules.filter(rule => rule.priority === priorityFilter);
            }
            
            // Atualizar contadores dos cards
            updateDashboardCounts(filteredRules);
            
            // Renderizar tabela com regras filtradas
            renderRulesTable(filteredRules);
        }
        
        // Função para atualizar contadores do dashboard
        function updateDashboardCounts(filteredRules) {
            const pendingCount = firewallRules.filter(rule => rule.status === 'pending').length;
            const approvedCount = firewallRules.filter(rule => rule.status === 'approved' || rule.status === 'production').length;
            const rejectedCount = firewallRules.filter(rule => rule.status === 'rejected').length;
            
            // Contar ambientes únicos
            const uniqueEnvironments = [...new Set(firewallRules.map(rule => rule.environment))].length;
            
            document.getElementById('pending-count').textContent = pendingCount;
            document.getElementById('approved-count').textContent = approvedCount;
            document.getElementById('rejected-count').textContent = rejectedCount;
            document.getElementById('environments-count').textContent = uniqueEnvironments;
        }
        
        // Função para mostrar detalhes da regra
        function showRuleDetails(ruleId) {
            const rule = firewallRules.find(r => r.id === ruleId);
            if (!rule) return;
            
            const modalBody = document.getElementById('modal-body-content');
            
            // Formatar datas
            const requestDate = new Date(rule.requestDate).toLocaleDateString('pt-BR');
            const approvalDate = rule.approvalDate ? new Date(rule.approvalDate).toLocaleDateString('pt-BR') : 'N/A';
            
            // Mapeamento de ambiente para texto
            const environmentText = {
                'production': 'Produção',
                'homologation': 'Homologação',
                'development': 'Desenvolvimento',
                'testing': 'Testes'
            };
            
            // Mapeamento de status para texto
            const statusText = {
                'pending': 'Pendente',
                'approved': 'Aprovado',
                'rejected': 'Rejeitado',
                'production': 'Em Produção'
            };
            
            // Mapeamento de prioridade para texto
            const priorityText = {
                'high': 'Alta',
                'medium': 'Média',
                'low': 'Baixa'
            };
            
            modalBody.innerHTML = `
                <div class="rule-details-grid">
                    <div class="detail-item">
                        <div class="detail-label">ID da Regra</div>
                        <div class="detail-value">${rule.id}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Nome</div>
                        <div class="detail-value">${rule.name}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Ambiente</div>
                        <div class="detail-value">${environmentText[rule.environment]}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Banco de Dados</div>
                        <div class="detail-value">${rule.database.toUpperCase()}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Status</div>
                        <div class="detail-value">${statusText[rule.status]}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Prioridade</div>
                        <div class="detail-value">${priorityText[rule.priority]}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Porta</div>
                        <div class="detail-value">${rule.port}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Protocolo</div>
                        <div class="detail-value">${rule.protocol}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">IP de Origem</div>
                        <div class="detail-value">${rule.sourceIP}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">IP de Destino</div>
                        <div class="detail-value">${rule.destinationIP}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Solicitante</div>
                        <div class="detail-value">${rule.requester}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Data da Solicitação</div>
                        <div class="detail-value">${requestDate}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Data de Aprovação</div>
                        <div class="detail-value">${approvalDate}</div>
                    </div>
                    ${rule.approvedBy ? `
                    <div class="detail-item">
                        <div class="detail-label">Aprovado por</div>
                        <div class="detail-value">${rule.approvedBy}</div>
                    </div>
                    ` : ''}
                    ${rule.rejectionReason ? `
                    <div class="detail-item">
                        <div class="detail-label">Motivo da Rejeição</div>
                        <div class="detail-value">${rule.rejectionReason}</div>
                    </div>
                    ` : ''}
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Descrição</div>
                    <div class="detail-value">${rule.description}</div>
                </div>
                
                <div class="detail-item">
                    <div class="detail-label">Regra JSON</div>
                    <div class="rule-json">${JSON.stringify(rule, null, 2)}</div>
                </div>
            `;
            
            // Mostrar o modal
            document.getElementById('rule-details-modal').classList.add('active');
        }
        
        // Função para aprovar uma regra
        function approveRule(ruleId) {
            if (confirm(`Tem certeza que deseja aprovar a regra ${ruleId}?`)) {
                const ruleIndex = firewallRules.findIndex(r => r.id === ruleId);
                if (ruleIndex !== -1) {
                    firewallRules[ruleIndex].status = 'approved';
                    firewallRules[ruleIndex].approvalDate = new Date().toISOString().split('T')[0];
                    firewallRules[ruleIndex].approvedBy = 'Admin';
                    
                    alert(`Regra ${ruleId} aprovada com sucesso!`);
                    filterRules(); // Reaplicar filtros para atualizar a tabela
                }
            }
        }
        
        // Função para rejeitar uma regra
        function rejectRule(ruleId) {
            const reason = prompt(`Digite o motivo para rejeitar a regra ${ruleId}:`);
            if (reason !== null) {
                const ruleIndex = firewallRules.findIndex(r => r.id === ruleId);
                if (ruleIndex !== -1) {
                    firewallRules[ruleIndex].status = 'rejected';
                    firewallRules[ruleIndex].approvalDate = new Date().toISOString().split('T')[0];
                    firewallRules[ruleIndex].approvedBy = 'Admin';
                    firewallRules[ruleIndex].rejectionReason = reason;
                    
                    alert(`Regra ${ruleId} rejeitada com sucesso!`);
                    filterRules(); // Reaplicar filtros para atualizar a tabela
                }
            }
        }
        
        // Inicialização da página
        document.addEventListener('DOMContentLoaded', function() {
            // Carregar regras na tabela
            renderRulesTable(firewallRules);
            
            // Atualizar contadores
            updateDashboardCounts(firewallRules);
            
            // Atualizar data da última atualização
            const now = new Date();
            document.getElementById('last-update').textContent = 
                `${now.toLocaleDateString('pt-BR')} ${now.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}`;
            
            // Configurar filtros
            document.getElementById('apply-filters').addEventListener('click', filterRules);
            
            // Configurar botão de nova regra
            document.getElementById('new-rule').addEventListener('click', function() {
                alert('Funcionalidade de nova regra será implementada na próxima versão!');
            });
            
            // Configurar fechamento do modal
            document.getElementById('close-modal').addEventListener('click', function() {
                document.getElementById('rule-details-modal').classList.remove('active');
            });
            
            // Fechar modal ao clicar fora
            document.getElementById('rule-details-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
